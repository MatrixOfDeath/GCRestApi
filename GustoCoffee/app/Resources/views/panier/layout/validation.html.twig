{% extends "::base.html.twig" %}

{% block title %}
    <title>GustoCoffee - Validation Panier</title>
{% endblock %}

{% block paddingTitle %}
    paddingTitle
{% endblock %}

{% block firstImg %}
    topPage topPanier
{% endblock %}


{% block titleHome %}
    <div class="banniere">
        <h1 class="colorWhite">{{ "Validation et Paiement"|trans }}</h1>
        <h3 class="colorWhite"> <i>{{ "Choisissez votre moyen de réglement"|trans }} !</i></h3>
    </div>
    {% if is_granted('IS_AUTHENTICATED_FULLY') == false %}
        <button class="buttonGC blueButton" onclick="location.href='{{ path('fos_user_registration_register') }}'">
            {{ 'Inscrivez-vous dès maintenant !'|trans }}</a>
        </button>
    {% endif %}
    <button class="buttonGC greenButton" form="paiemnt-commande">
        {{ 'Payer directiment >'|trans }}</a>
    </button>
{% endblock %}

{% block firstBlock %}
    <div class="row addPadding">

        <div class="col-md-3 hidden-xs hidden-sm addPadding">
            <div class="well">
                <ul class="nav nav-list">
                    <li class="nav-header">{{ "Nos produits"|trans }}</li>
                    {{ render(controller('AppBundle:TypeDeProduit:menu')) }}
                </ul>
            </div>
        </div>

        <div class="col-md-8 col-xs-12">
            
            
            <h2>Valider mon panier</h2>

            <table class="table table-striped table-hover">
                <thead>
                <tr>
                    <th>Salle choisi</th>
                    <th>Nombre d'heures</th>
                    <th>Prix à l'heure TTC</th>
                    <th>Prix salle HT</th>
                    <th>Total TTC</th>
                </tr>
                </thead>
                <tbody>

                {%  for salle in commande.commande.salle %}
                        <tr>
                            <td>{{ salle.reference }}</td>
                            <td>
                                {{ "Le " ~ salle.date  " De" ~ salle.debutHeure ~ ' à '~ salle.finHeure ~ "Temps :" ~ salle.heures ~ ":" ~ salle.minutes ~"H" }}
                            </td>
                            <td>{{ salle.prixHT }} €</td>
                            <td>{{ salle.prixSalleHT }} €</td>
                            <td>{{ salle.prixTTC }} €</td>
                        </tr>
                    {% endfor %}
                    </tbody>
            </table>

            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Références</th>
                        <th>Quantité</th>
                        <th>Prix unitaire</th>
                        <th>Total HT</th>
                        <th>Total TTC</th>
                    </tr>
                </thead>
                <tbody>
                    {% for produit in commande.commande.produit %}
                    <tr>
                        <td>{{ produit.reference }}</td>
                        <td>
                            {{ produit.quantite }}
                        </td>
                        <td>{{ produit.prixHT }} €</td>
                        <td>{{ produit.prixHT * produit.quantite }} €</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {#{% set totalReduc = 0 %}#}
            <dl class="dl-horizontal pull-right">
                {% if commande.commande.produit is defined and commande.commande.produit|length != 0 %}
                    <dt>Total Produits HT :</dt><dd>{{ commande.commande.prixHT  }}€</dd>
                {% endif %}
                {% for key, tva in commande.commande.tva %}
                    <dt>TVA {{ key }} :</dt><dd>{{ tva }} €</dd>
                {% endfor %}
                <dt>Total Salle TTC :</dt><dd>{{ commande.commande.prixSalleTTC  }}€</dd>
                {% for key, tva in commande.commande.tvaSalle %}
                    <dt>dont {{ key }} TVA Salle:</dt><dd>{{ tva }} €</dd>
                {% endfor %}
                {% if commande.commande.thirdHourFree is defined and commande.commande.thirdHourFree > 0 %}
                    <dt class="reduction-3h">Réduction 3ème heure:</dt><dd class="reduction-3h">{{ commande.commande.thirdHourFree }} €</dd>
                {% endif %}
                {% if commande.commande.produit|length != 0 and commande.commande.salle|length != 0 %}
                    {#{% set totalReduc =  ((commande.commande.totalTTC) * 0.1)|number_format(2, '.', ',') %}#}
                    <dt>Sous-Total TTC :</dt><dd>{{ commande.commande.prixTTC + commande.commande.prixSalleTTC }} €</dd>
                    <dt class="reduction-10">Réduction -10% :</dt><dd class="reduction-10">-{{ commande.commande.reduction10 }} €</dd>
                    {#<dt>Montant Total TTC :</dt><dd>{{ ((commande.commande.totalTTC)  - ((commande.commande.totalTTC) * 0.1))|number_format(2, '.', ',') }} €</dd>#}
                {% endif %}
                {% if commande.commande.VATtotalTVA is defined %}
                    <dt class="reduction-TVA">Non assujetti à la tva:</dt><dd class="reduction-10">-{{ commande.commande.VATtotalTVA }} €</dd>
                {% endif %}
                <dt class="montant-total">Montant Total TTC :</dt><dd class="montant-total">{{ commande.commande.totalTTC }} €</dd>
            </dl>

            <div class="span3 pull-left">
                <dl class="pull-left">
                    <dt><h4>Adresse personnel</h4></dt>
                    <dt>{{ commande.commande.livraison.prenom }} {{ commande.commande.livraison.nom }}</dt>
                    <dt>{{ commande.commande.livraison.adresse }}</dt>
                    <dt>{{ commande.commande.livraison.cp }} {{ commande.commande.livraison.ville }}
                        - {{ commande.commande.livraison.pays }}</dt>
                </dl>
            </div>

            <div class="span4 pull-left">
                <dl class="pull-left">
                    <dt><h4>Adresse de facturation</h4></dt>
                    <dt>{{ commande.commande.facturation.prenom }} {{ commande.commande.facturation.nom }}</dt>
                    <dt>{{ commande.commande.facturation.adresse }}</dt>
                    <dt>{{ commande.commande.facturation.cp }} {{ commande.commande.facturation.ville }} </dt>
                    <dt>{{ commande.commande.facturation.pays }}</dt>
                    {% if commande.commande.facturation.vatnumber is defined and commande.commande.facturation.vatnumber|length != 0 %}<dt>N° TVA Intra-C: {{ commande.commande.facturation.vatnumber }}</dt>{% endif %}
                </dl>
            </div>
            
            <div class="clearfix"></div>
            
            <form id="paiement-commande" action="{{ path('paiement_commande', { 'id' : commande.idcommande }) }}" method="POST"/>
                <input name="token" type="hidden" value="{{ commande.commande.token }}" />
                <input name="prix" type="hidden" value="{{ commande.commande.prixTTC }}" />
                <input name="totalTTC" type="hidden" value="{{ commande.commande.totalTTC }}" />
                <input name="date" type="hidden" value="{{ commande.datecommande|date('dmyhms') }}" />
                <button type="submit" class="btn btn-success pull-right">Payer</button>
            </form>
            
            <a href="{{ path('livraison_panier') }}" class="btn btn-primary">retour</a>
        </div>
        <div class="col-md-1 hidden-xs hidden-sm"></div>
    </div>

{% endblock %}